pre-commit:
  parallel: true
  commands:
    environment-check:
      run: |
        echo "üîç Environment check starting..."
        echo "Current path: $PWD"
        echo "Current user: $(whoami)"

        # „É≠„Éº„Ç´„É´Áí∞Â¢ÉÊ§úÂá∫
        if [[ "$PWD" == "/Users/"* ]]; then
          echo ""
          echo "üö® FATAL ERROR: Local environment detected"
          echo "Current path: $PWD"
          echo "Current user: $(whoami)"
          echo ""
          echo "‚ùå ALL COMMITS BLOCKED"
          echo "Switch to Container Use environment before committing"
          echo ""
          echo "Required: Use mcp__container-use__ tools only"
          exit 1
        fi

        # ContainerÁí∞Â¢ÉÁ¢∫Ë™ç
        if [[ ! -f "/.dockerenv" ]] && [[ ! "$CONTAINER" == "true" ]] && [[ ! "$PWD" == "/workspaces/"* ]] && [[ ! "$PWD" == "/workdir"* ]]; then
          echo ""
          echo "üö® FATAL ERROR: Not in container environment"
          echo "Current environment indicators:"
          echo "  - dockerenv: $([ -f /.dockerenv ] && echo 'found' || echo 'missing')"
          echo "  - CONTAINER var: $([ -n "$CONTAINER" ] && echo 'set' || echo 'unset')"
          echo "  - Workspace path: $PWD"
          echo ""
          echo "‚ùå ALL COMMITS BLOCKED"
          echo "Use Container Use environment only"
          exit 1
        fi

        echo "‚úÖ Container environment verified"

    no-verify-prevention:
      run: |
        # --no-verify ‰ΩøÁî®Ê§úÂá∫Ôºà„Çª„Ç≠„É•„É™„ÉÜ„Ç£ÊîπÂñÑÁâàÔºâ
        if pgrep -f "\-\-no-verify" > /dev/null 2>&1; then
          echo ""
          echo "üö® FATAL ERROR: --no-verify flag detected"
          echo "‚ùå BYPASS ATTEMPTS BLOCKED"
          echo ""
          echo "All commits must pass quality checks"
          exit 1
        fi
        echo "‚úÖ No bypass attempts detected"

    docs-check:
      run: yarn check:docs
      files: git diff --name-only --cached --diff-filter=d | grep '\.md$' || true
      skip: git diff --name-only --cached --diff-filter=d | grep -q '\.md$' || echo "skip"

    test-check:
      run: yarn test:run
      files: git diff --name-only --cached --diff-filter=d | grep -E '\.(ts|tsx|js|jsx)$' || true
      skip: git diff --name-only --cached --diff-filter=d | grep -qE '\.(ts|tsx|js|jsx)$' || echo "skip"

    file-size-check:
      run: |
        echo "üîç Checking file sizes..."
        large_files=()

        # Â§âÊõ¥„Åï„Çå„Åü„Éï„Ç°„Ç§„É´„ÅÆ„Çµ„Ç§„Ç∫„ÉÅ„Çß„ÉÉ„ÇØ
        for file in $(git diff --cached --name-only --diff-filter=d); do
          if [[ -f "$file" && "$file" =~ \.(ts|tsx|js|jsx)$ ]]; then
            lines=$(wc -l < "$file" 2>/dev/null || echo 0)
            if [[ $lines -gt 150 ]]; then
              large_files+=("$file: $lines lines (max: 150)")
            fi
          fi
        done

        if [[ ${#large_files[@]} -gt 0 ]]; then
          echo ""
          echo "üö® FATAL ERROR: Files exceed size limit"
          printf '%s\n' "${large_files[@]}"
          echo ""
          echo "‚ùå COMMITS BLOCKED"
          echo "Split large files before committing"
          exit 1
        fi

        echo "‚úÖ All files within size limits"