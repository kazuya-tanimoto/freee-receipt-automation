# PBI改善計画 - AI駆動開発

## 概要

このドキュメントは、AI駆動開発により適したProduct Backlog Items (PBI)の改善計画を概説します。
目標は、AIエージェントが効果的に実装できる、きめ細かく明確に定義されたPBIを作成することです。

## 現在の状況

- [x] 既存のPBI構造を分析
- [x] 改善箇所を特定
- [x] 詳細な実装計画を作成
- [x] PBIテンプレートを作成
- [x] フェーズ1のPBI分解を設計（5つの詳細なPBIを作成）
- [x] フェーズ1の詳細なPBIを作成（7ファイル完成）
- [x] フェーズ1のPBIとテンプレートをレビュー（完了）
- [x] フェーズ1レビューからのフィードバックを適用（PBI-1-1-2分割、テンプレート強化）
- [x] フェーズ2のPBIをリファクタリング（5つの大きなPBI → 19の詳細なPBIで20 SP）
- [ ] フェーズ3のPBIをリファクタリング（3つの大きなPBI → 約15の詳細なPBI）
- [ ] フェーズ4のPBIをリファクタリング（3つの大きなPBI → 約15の詳細なPBI）
- [ ] フェーズ5のPBIをリファクタリング（3つの大きなPBI → 約15の詳細なPBI）
- [ ] すべての英語版PBIの最終レビュー
- [ ] すべてのPBIの日本語版を作成
- [ ] 最終品質チェックとドキュメント完成

## 改善戦略

### 1. 粒度の洗練

- **現在**: PBIは5-8ストーリーポイント（2-4日）- AI実装には大きすぎる
- **目標**: 1-2ストーリーポイントのタスク（各0.5-1日）に分解

### 2. 実装詳細の強化

- **現在**: 具体的な技術実装詳細が不足
- **目標**: 正確なファイルパス、コードパターン、APIスキーマ、データベース構造、環境変数を追加

### 3. テストの分離

- **現在**: テストが実装とバンドルされている
- **目標**: ユニット、統合、E2Eテスト用の個別のPBIを作成

### 4. ドキュメントの分離

- **現在**: ドキュメントが実装とバンドルされている
- **目標**: 技術、ユーザー、APIドキュメント用の個別のPBIを作成

### 5. 依存関係の明確化

- **現在**: 依存関係が高レベルの参照
- **目標**: 正確なインターフェース、データ構造、API要件を指定

## フェーズ1の分解（完了 - 合計: 19 SP）

### PBI-1-1: Supabaseプロジェクトセットアップ（7 SP）

- PBI-1-1-1: Supabaseプロジェクト初期化（1 SP）✅
- PBI-1-1-2: コアテーブル作成（1 SP）✅
- PBI-1-1-3: トランザクションテーブル作成（1 SP）✅
- PBI-1-1-4: RLSとタイプ設定（1 SP）✅
- PBI-1-1-5: 認証設定（1 SP）✅
- PBI-1-1-6: 環境設定（1 SP）✅
- PBI-1-1-7: ドキュメント作成（1 SP）✅

### PBI-1-2: ストレージとOCR（9 SP）

- PBI-1-2-1: ストレージバケット設定（1 SP）
- PBI-1-2-2: ファイルアップロードAPI（2 SP）
- PBI-1-2-3: OCRサービス統合（2 SP）
- PBI-1-2-4: OCRデータ抽出（2 SP）
- PBI-1-2-5: ユニットテスト（1 SP）
- PBI-1-2-6: ドキュメント作成（1 SP）

### PBI-1-3: freee API統合（6 SP）

- PBI-1-3-1: APIクライアント設定（1 SP）
- PBI-1-3-2: 認証フロー（1 SP）
- PBI-1-3-3: トランザクションAPI統合（2 SP）
- PBI-1-3-4: ユニットテスト（1 SP）
- PBI-1-3-5: ドキュメント作成（1 SP）

## フェーズ2の分解（完了 - 合計: 22 SP）

### PBI-2-1: 基盤タスク（3 SP）

- PBI-2-1-1: OpenAPI定義作成（1 SP）✅
- PBI-2-1-2: 共通OAuthモジュール（1 SP）✅
- PBI-2-1-3: オブザーバビリティ設定（1 SP）✅

### PBI-2-2: Gmail API統合（6 SP）

- PBI-2-2-1: Gmail OAuth設定（1 SP）✅
- PBI-2-2-2: Gmail基本API操作（1 SP）✅
- PBI-2-2-3: Gmailビジネスロジック統合（2 SP）✅
- PBI-2-2-4: Gmailエラーハンドリングとリトライロジック（1 SP）✅
- PBI-2-2-5: Gmailテストとドキュメント作成（1 SP）✅

### PBI-2-3: Google Drive統合（6 SP）

- PBI-2-3-1: Google Drive OAuth設定（1 SP）✅
- PBI-2-3-2: Google Drive基本API操作（1 SP）✅
- PBI-2-3-3: Google Driveビジネスロジック統合（2 SP）✅
- PBI-2-3-4: Google Driveエラーハンドリングとリトライロジック（1 SP）✅
- PBI-2-3-5: Google Driveテストとドキュメント作成（1 SP）✅

### PBI-2-4: フォルダ/ファイル管理（4 SP）

- PBI-2-4-1: ファイル命名システム（1 SP）✅
- PBI-2-4-2: フォルダ構造管理（1 SP）✅
- PBI-2-4-3: 重複処理ロジック（1 SP）✅
- PBI-2-4-4: ファイル管理テストとドキュメント作成（1 SP）✅

### PBI-2-5: スケジュール実行（3 SP）

- PBI-2-5-1: pg_cron設定とスケジュールジョブ基盤（1 SP）✅
- PBI-2-5-2: バックグラウンドジョブキュー実装（2 SP）✅

## フェーズ3-5の計画に関する考慮事項

### リスク管理

1. **外部API変更**: Google APIとfreee APIの更新を監視
2. **設計/調査バッファ**: 仕様のギャップ用に1-2 SPを予約

### 技術的考慮事項

1. **UIコンポーネントライブラリ**: インターフェース開発前にUIフレームワークを評価
2. **状態管理**: 複雑なUIインタラクション用の適切なソリューションを選択
3. **リアルタイム更新**: WebSocketまたはServer-Sent Eventsを検討

## 実装タイムライン

- **第1週**: フェーズ1のPBIレビューとフェーズ2のPBIリファクタリング
- **第2週**: フェーズ3と4のPBIリファクタリング
- **第3週**: フェーズ5のPBIリファクタリングと最終レビュー
- **第4週**: 日本語翻訳と最終品質チェック

## 成功基準

- [ ] すべてのPBIが最大1-2ストーリーポイント
- [ ] 各PBIに明確な実装詳細がある
- [ ] 依存関係が明示的に定義されている
- [ ] テストとドキュメントが個別のPBI
- [ ] AIエージェントが曖昧さなくPBIを実装できる

## 継続用

別のチャットでこの作業を継続するには：
「`/Users/kazuya/src/freee-receipt-automation/docs/requirements/backlog/PBI-improvement-plan.md`の
PBI改善計画の作業を継続してください。
フェーズ1とフェーズ2は完了しています。次のステップは、改善されたPBIテンプレートを使用して
フェーズ3のPBI（管理インターフェース）を詳細な1-2 SPのタスクにリファクタリングすることです。」
