# PBI-2-5-1: pg_cronセットアップとスケジュールジョブ基盤

## 説明

Supabase内でスケジュールタスク実行のためのPostgreSQL cron拡張（pg_cron）をセットアップします。
これには自動レシート処理の基盤作成、基本的なスケジューリングパターンの実装、
スケジュールジョブのモニタリング確立が含まれます。

## 実装詳細

### 作成/修正するファイル

1. `supabase/migrations/008_enable_pg_cron.sql` - pg_cron拡張の有効化
2. `supabase/migrations/009_create_scheduled_jobs.sql` - スケジュールジョブテーブル
3. `src/lib/cron/job-scheduler.ts` - ジョブスケジューリングユーティリティ
4. `src/lib/cron/cron-patterns.ts` - 一般的なcronパターン
5. `src/services/scheduled-processor.ts` - スケジュール処理サービス
6. `docs/cron/scheduling-guide.md` - スケジューリングドキュメント

### 技術要件

- Supabaseでpg_cron拡張を有効化
- スケジュールジョブ設定テーブルを作成
- 一般的なスケジューリングパターンを実装
- ジョブ実行ステータスを監視
- タイムゾーンの考慮（JST）を処理

### 実装コード

- スケジュールジョブのデータベーススキーマ
- pg_cron設定
- ジョブスケジューリングユーティリティ
- モニタリングクエリ
- 一般的なcronパターン

## メタデータ

- **ステータス**: 未開始
- **実際のストーリーポイント**: [完了後に記入]
- **作成日**: 2025-06-05
- **開始日**: [日付]
- **完了日**: [日付]
- **担当者**: [AIアシスタントIDまたは人間]
- **レビュアー**: [このPBIをレビューした人]
- **実装メモ**: [完了後の学び]

## 受け入れ基準

- [ ] pg_cron拡張が有効化されている
- [ ] スケジュールジョブテーブルが作成されている
- [ ] ジョブをスケジュールして実行できる
- [ ] ジョブ実行が監視されている
- [ ] タイムゾーン処理が正しく動作する
- [ ] 失敗したジョブのエラー処理

## 依存関係

- **必須**: データベースインフラストラクチャ
- **必須**: Supabaseプロジェクトセットアップ

## テスト要件

- ユニットテスト: cronパターン検証
- 統合テスト: ジョブスケジューリングと実行
- パフォーマンステスト: 並行ジョブ処理
- エッジケース: 夏時間の移行

## 見積もり

1ストーリーポイント

## 優先度

高 - 自動処理の基盤
