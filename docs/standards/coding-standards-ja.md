# コーディング規約

## 概要
このドキュメントは、プロジェクトのコード品質を維持するための規約を定義します。

## コードスタイル

### 1. 命名規則
- 変数名: camelCase（例: `userName`）
- 関数名: camelCase（例: `getUserData`）
- クラス名: PascalCase（例: `UserService`）
- 定数: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）

### 2. ファイル構造
- ファイルあたりの行数制限:
  - 基本制限: 150行
  - 絶対制限: 250行
  - 150行を超える場合、以下の対応が必要:
    - 機能の分割（複数のファイルに分割）
    - 共通処理の抽出
    - ユーティリティ関数の分離
  - 250行を超える場合、コードの再設計が必要
- 250行を超えても許容される例外:
  - テストファイル（テストケースが多い場合）
  - データ構造や型定義ファイル
  - 自動生成コード（以下の条件を満たす場合のみ）:
    - 可能な限り生成コードを分割
    - 生成コードの各部分は150行以内
    - 各部分は単一の責任を持つ
    - 生成コードは適切にドキュメント化

### 3. AIエージェントによるコード生成
- AIエージェントが生成するコードは150行以内に収める
- 150行を超える場合、以下の基準で分割:
  - 機能ごとに分割
  - 各部分は150行以内
  - 各部分は単一の責任を持つ
  - 各部分の目的と動作を明確に説明
- 生成コードの品質チェック:
  - コードレビューの実施
  - テストカバレッジの確保
  - パフォーマンスとセキュリティの検証
  - 行数制限の遵守確認

### 4. コメント規約
- 関数の説明: JSDoc形式
- 複雑なロジック: インラインコメント
- TODOコメント: 期限と担当者を含める

## コード品質

### 1. テスト
- 単体テストカバレッジ: 80%以上
- テストファイルの命名: `*.test.ts`
- モックの使用: 外部依存を適切にモック化

### 2. エラー処理
- 例外処理: 具体的な例外型を指定
- エラーメッセージ: ユーザーフレンドリー
- ロギング: 適切なログレベルを使用

### 3. パフォーマンス
- 非同期処理: Promise/async-awaitの適切な使用
- メモリ管理: 不要な参照の解放
- データベースクエリ: インデックスの活用

## セキュリティ

### 1. 入力検証
- ユーザー入力: 適切な検証
- SQLインジェクション防止: パラメータ化クエリ
- XSS防止: エスケープ処理

### 2. 認証と認可
- パスワード: ハッシュ化
- セッション管理: 適切なタイムアウト
- アクセス制御: 最小権限の原則

## 参考リンク
- [プロジェクトルートREADME](../../README-ja.md)
- [AIコンテキスト最適化](../../ai/context/context-optimization-ja.md)
- [運用ガイドライン](../ops/operational-guidelines-ja.md)
- [レビューガイドライン](./review-guidelines-ja.md) 