# AI-Driven Development Guidelines

## Document Overview

### Purpose

To define a "repository map" where human developers and multiple AI agents can share the same information source
and collaborate seamlessly on code, design, and operations.

### Expected Benefits

- Reduce onboarding time for new participants and minimize rework costs
- Improve LLM response accuracy through RAG utilization
- Prevent "documentation decay" by automatically checking differences and compatibility in CI

### Use Cases

- New product launch
- Refactoring existing repositories / OSS publication preparation
- During audits and security reviews (providing centralized evidence & ADR)

## 1. Structure Tree

```text
.
├ README.md
├ CHANGELOG.md
├ .devcontainer.json        # ← Optional
├ .github/
│   └ workflows/
├ src/
├ tests/
├ docs/
│   ├ overview.md
│   ├ requirements/
│   │   ├ spec/            # "Coarse-grained" requirements
│   │   └ backlog/         # PBI・GitHub Issue integration
│   ├ design/
│   │   ├ architecture/
│   │   ├ db/
│   │   └ ui/
│   ├ api/
│   ├ standards/
│   │   └ coding-standards.md  # コーディング規約
│   ├ test/
│   ├ ops/
│   │   └ operational-guidelines.md  # 運用ガイドライン
│   └ adr/
└ ai/
    ├ system_prompt.md
    ├ glossary.yml
    ├ config/
    ├ prompts/
    ├ tasks/
    ├ context/
    │   └ context-optimization.md  # AIコンテキスト最適化
    ├ examples/            # ← Optional
    ├ feedback/            # ← Optional
    └ history/             # ← Optional
```

## 2. File/Directory Quick Reference

| Path | Required/Optional | Purpose | Main Contents | Maintenance Frequency |
|------|-----------|------|----------|-----------|
| `/README.md` | ✅ Required | TL;DR / Quick Start | 5-minute setup procedure | Each release |
| `/CHANGELOG.md` | ✅ Required | Version history (Keep‑a‑Changelog) | Added / Changed / Fixed | Each release |
| `Makefile` | ✅ Required | Common command collection | setup, test, embed, etc. | When adding features |
| `.github/workflows/` | ✅ Required | CI / CD & Security Hardening | Lint／Test／Deploy | Each update |
| `.devcontainer.json` | ✅ Required | Reproducible dev environment | image／extensions | Environment changes |
| `docs/` | ✅ Required | Human & AI shared knowledge base | See section 3 | As needed |
| `ai/` | ✅ Required | AI meta-layer | See section 4 | As needed |
| `ai/context/` | ✅ Required | AI context optimization | Context management | When major policy changes |
| `ai/examples/` | ▶︎ Recommended | Collection of successful patterns | Best implementations | When PR is adopted |
| `ai/feedback/` | ▶︎ Auto-gen env | AI Output Review | Evaluation comments | Each PR |
| `ai/history/` | ▶︎ Optional | Session Log & Summary Storage | Chat history JSON, daily digest | Auto-generation |
| `data-contract/` | ▶︎ Domain-dependent | Data Contract & Schema | AsyncAPI, Avro schema | Schema changes |
| `benchmarks/` | ▶︎ Optional | Performance/Cost Comparison | LLM cost table, execution time | Regular measurement |

## 3. `docs/` — Human & AI Shared Knowledge Base

### 3.1 `overview.md`

Business background, goals, and constraints. Update when goals change.

### 3.2 `requirements/` — Two-layer Management

| Subpath | Purpose | Operation |
|---------|---------|-----------|
| `spec/` | Business requirements, non-functional (`REQ‑001.md` etc.) | Confirmed changes ➡ Link to ADR |
| `backlog/` | PBI / Implementation tasks (GitHub Issue ⇔ MD/YAML) | Auto-generated from Issue template→Close |

> **FAQ**  
> **Are coarse-grained requirements and implementation tasks mixed?**  
> Framework specifications are in `spec/`, implementation instructions are in `backlog/`, enabling both static
> design documents and dynamic backlogs.

### 3.3 `standards/` — コーディング規約

| Subpath | Usage | Operation |
|----------|------|------|
| `coding-standards.md` | コーディング規約 | コード品質の維持と一貫性の確保 |

**主な内容**:

- ファイル行数制限（基本150行、最大250行）
- 命名規則
- コードスタイル
- AIエージェントによるコード生成のガイドライン

### 3.4 `ops/` — 運用ガイドライン

| Subpath | Usage | Operation |
|----------|------|------|
| `operational-guidelines.md` | 運用ガイドライン | プロジェクトの運用に関する重要なガイドライン |

**主な内容**:

- デプロイメントプロセス
- モニタリング方針
- インシデント対応
- バックアップとリカバリ

### 3.5 Other Subdirectories

| Path | Role | Notes |
|------|------|------|
| `design/architecture/` | C4 diagrams (Mermaid) | `.mmd`→SVG auto-generated by Actions |
| `api/` | `openapi.yaml` (SemVer) | MAJOR++ for breaking changes |
| `adr/` | MADR template (`nadr-2.1.2.md`) | 1 decision = 1 file |

**`adr/` Operation Rules**:

- **ID Assignment**: Use format `ADR-0001`, `ADR-0002` in sequential order
- **Maintenance**: Always add a new ADR for breaking changes or technology selection

## 4. `ai/` — AI Meta-layer

| Directory | Purpose | Maintenance Method |
|--------------|------|-----------|
| `system_prompt.md` | Common assumptions and prohibitions | Weekly review |
| `glossary.yml` | Domain terms ⇔ Class names | Add new terms |
| `prompts/` | Reusable templates | Test → Promotion |
| `tasks/` | Autonomous task definitions | When adding new flows |
| `context/` | Long-form background (for RAG) | When major policy changes |
| `examples/` | Successful patterns | When best practices are adopted |
| `feedback/` | AI output reviews | Bot saved |
| `history/` | sessions / summaries / insights | Nightly organization |

**`history/` Structure and Operation**:

| Subdirectory | Purpose | Example |
|-----------------|------|----|
| `sessions/` | Raw chat logs (JSON) | `2025-05-06T06:00:session.json` |
| `summaries/` | Markdown summaries of the above | `2025-05-06T06:00:summary.md` |
| `insights/` | Improvement points extracted by periodic batch | `2025-W19-insights.md` |

**Maintenance Method**:

- Automatically save to `sessions/` after session ends
- Generate `summaries/` daily via CRON
- Generate `insights/` weekly and transcribe to `ai/feedback/`

## 5. CI / Development Environment Points

- **Workflows**: `lint-and-test.yml`, `security-scan.yml`, `build-docker.yml`  
- **Schema diff**: Confluent Registry compatibility check  
- **DevContainer**: Centralized management of VS Code extensions, postCreate

## 6. Selectively Added Directories

| Path | Timing | Use Case |
|------|-----------|-------------|
| `docs/test/` | Test expansion | Test pyramid management |
| `docs/ops/` | Dedicated SRE | SLO / Runbook |
| `benchmarks/` | LLM measurement | OpenAI Evals, etc. |
| `data-contract/` | Event-driven | AsyncAPI / Avro |

### `data-contract/` Details

**Usage**:  
Store "contracts" between data producers and consumers as code. Prevent breaking changes similar to API contracts.

- **Placement**: `customer.avro`, `orders.proto`, `contract.md`, etc.
- **Maintenance Method**:
  1. Create PR when schema changes, run backward compatibility tests in CI
  2. Always include `BREAKING CHANGE` tag in release notes

### `benchmarks/` Details

**Usage**:  
Monitor LLM inference costs, performance, memory, etc. to provide decision-making material for model/prompt changes.

- **Placement**: `benchmark_2025-05.csv`, `plots/latency.png`, `README.md`
- **Maintenance Method**:
  1. Measure with `make benchmark` → Append to CSV
  2. Update graphs with Python script, attach to PR

## 7. Customization References

- **Bulletproof React** — Large-scale React configuration examples  
- **Naming Cheatsheet** — Clear naming guidelines  

## 8. Update Flow Summary

1. Issue / ADR for policy decisions  
2. PR: Implementation & documentation updates  
3. CI: Lint / Test / schema diff / Secret Scan  
4. Review & merge: Save summary to `ai/feedback/`  
5. Update CHANGELOG → Tag → Release  

## 9. Future Improvement Ideas

- Monitor latency and cost with `benchmarks/`  
- Automate Mermaid→SVG to eliminate diagram and source divergence  
- Track history with `version:` field in `ai/prompts/`
